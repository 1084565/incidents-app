#!/usr/bin/env node

// helpers
const _append = str => ({ to: file => cds.utils.fs.promises.appendFile(cds.utils.path.join(cds.root,file), str) })
const _stringified = o => JSON.stringify(o,null,2)

const cds = require("@sap/cds")
const { read, write, append=_append } = cds.utils

const checkout = {

  async 'remote-service' () {
    const xmpls = await read ('xmpls/remote-service/package.json')
    const base = await read ('package.json')
    for (let each of ['API_BUSINESS_PARTNER'])
      base.cds.requires[each] = xmpls.cds.requires[each]
    await write (_stringified(base)) .to ('package.json')
  },

  async messaging () {
    const xmpls = await read ('xmpls/messaging/package.json')
    const base = await read ('package.json')
    for (let each of ['API_BUSINESS_PARTNER','messaging'])
      base.cds.requires[each] = xmpls.cds.requires[each]
    await write (_stringified(base)) .to ('package.json')
    await append ('\n'+`using from './incidents/field'; //> adds email fields to UI`+'\n') .to ('app/services.cds')
  }
}

const [,,$1] = process.argv
checkout[$1]?.() || console.log('Usage: ./checkout remote-service | messaging')
